# Reproducible Research: Peer Assessment 1
Title:  PA1_template.Rmd                         

## Loading and preprocessing the data
```{r filedownload,echo=FALSE,results=FALSE}
setwd("~/gitDir_studentcoursera/RepData_PeerAssessment1")
if(!file.exists("activity.csv")) unzip("activity.zip")
```

```{r loadData}
activity <- read.csv("activity.csv", colClasses = c("integer","character","integer"),
                     comment="",stringsAsFactors = FALSE, nrows = 17568)
```

## What is mean total number of steps taken per day?
```{r stepsMean}
library(reshape2)

completeactvity <- activity[complete.cases(activity$steps),]
totalsteps <- melt(tapply(completeactvity$steps, factor(as.Date(completeactvity$date)), sum))
dimnames(totalsteps)[[2]] <- c("date","total")
mn1 <- mean(totalsteps$total)
md1 <- median(totalsteps$total)
```

#### Total number of steps taken each day
```{r plotHist}
### if 'breaks=50' is not specified, then in the range of 0 to 5000 steps, there is an increase 
## from 10 to 13 after imputting values for missing data. But, with "breaks=50", 
## we can clearly see that there are 8 days in the range 0 to 5000 steps, which is not present 
## before imputting values. Thus, adding breaks=50 brings in more clarity. 
## Tried with different breaks values [100, 25, etc.], but 50 would help us to compare without NAs 
## and with imputting missing values better.

hist(totalsteps$total,breaks=50,col="lightgreen",xlab='Total Steps', ylab = "Days", 
     main = "Total number of steps taken each day")
```

Mean is `r sprintf("%.0f",mn1) `. Median is `r sprintf("%.0f",md1)`.

## What is the average daily activity pattern?
```{r dailyPattern}
library(reshape2)
library(plyr)

sumsteps <- ddply(completeactvity, .(interval), summarize, sumsteps=sum(steps))
countdates <- count(completeactvity, vars = .(interval))
merged <- merge(sumsteps,countdates, by.x = "interval", by.y = "interval")
averaged <- cbind(merged,merged$sumsteps/merged$freq)
rm(list=c("sumsteps","countdates","merged"))
dimnames(averaged)[[2]] <- c("interval","totalsteps","countdates","average")

max5min <- averaged$interval[which.max(averaged$average)]

## to get it in "hrs:mins" format
max5min_time <- format(strptime(paste("2012-10-02", (max5min  %/% 100), 
                                      (max5min %% 100)),"%F%H%M"), "%H:%M")
```

#### Time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
```{r plotL}
plot(averaged$average ~ averaged$interval, type = "l", xlab = "5-minute interval",
     ylab = "average steps",col="blue")
rm("averaged")
```

`r max5min_time` [`r max5min`] is the 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps.

## Imputing missing values
```{r missingValues}
sum(is.na(activity$steps))
```
`r sum(is.na(activity$steps))` is the total number of missing values [steps] in the dataset. 
  
#### A new data set with the new strategy to fill in the missing values. Here, the NA values in step is filled with the median value for each interval.
```{r fillStrategy}
medsteps <- melt(tapply(completeactvity$steps,  completeactvity$interval, median))
filledData <- merge(activity,medsteps, by.x = "interval", by.y = "Var1",all = TRUE)
filledData[["steps"]][is.na(filledData[["steps"]])] <- filledData[["value"]][is.na(filledData[["steps"]])]
reorderFilledData <- filledData[order(filledData$date,filledData$interval),c(2,3,1)]
rm(list=c("medsteps","filledData","completeactvity"))

totalfilledsteps <- melt(tapply(reorderFilledData$steps, factor(as.Date(reorderFilledData$date)), sum))
dimnames(totalfilledsteps)[[2]] <- c("date","total")
mn2 <- mean(totalfilledsteps$total)
md2 <- median(totalfilledsteps$total)
```

#### Total number of steps taken each day (after filling missing values)
```{r plotFillHist}
### if 'breaks=50' is not specified, then in the range of 0 to 5000 steps, there is an increase 
## from 10 to 13 after imputting values for missing data. But, with "breaks=50", 
## we can clearly see that there are 8 days in the range 0 to 5000 steps, which is not present 
## before imputting values. Thus, adding breaks=50 brings in more clarity. 
## Tried with different breaks values [100, 25, etc.], but 50 would help us to compare without NAs 
## and with imputting missing values better.

hist(totalfilledsteps$total, breaks=50, col="lightpink", xlab='Total Steps', 
     main = "Total number of steps taken each day (after filling missing values)")
```

After filling the missing values, mean is `r sprintf("%.0f",mn2) `. Median is `r sprintf("%.0f",md2)`.

#### Do these values differ from the estimates from the first part of the assignment? 
* YES, they do.  

#### What is the impact of imputing missing data on the estimates of the total daily number of steps?  
Following are the observations:   
  
* As median is considered to fill in the values, the mean and median has decreased by `r ((mean(totalsteps$total) - mean(totalfilledsteps$total)) / mean(totalsteps$total)) * 100`% and `r ((median(totalsteps$total) - median(totalfilledsteps$total)) / median(totalsteps$total)) * 100`% respectively.  
* Before and After:  
Before imputing missing data mean and median is `r sprintf("%.0f",mn1) ` and `r sprintf("%.0f",md1)` respectively.  
After imputting missing  data mean and median is `r sprintf("%.0f",mn2) ` and `r sprintf("%.0f",md2)` respectively.  
* As per histogram comparison, there are about 8 days increase in the range of 1000 to 2000 total steps; which is not seen in the first part of the assignment.  
   * The dates which have missing values are `r unique(activity$date[is.na(activity$steps)])`, i.e., there are total of `r length(unique(activity$date[is.na(activity$steps)]))` days. Thus, with 50 breaks, we can do a proper comparison; as displayed in the above histograms.  
   * The total number of steps less than 1500 with complete cases are `r totalsteps$total[totalsteps$total < 1500]`  
   * The total number of steps less than 1500 with imputting values for missing cases are `r totalfilledsteps$total[totalfilledsteps$total < 1500]` 
* More specific details at date level [against total steps for each date]:  
```{r snippet,echo=FALSE}
tapply(reorderFilledData[["steps"]][is.na(activity[["steps"]])], reorderFilledData$date[is.na(activity[["steps"]])], sum)
rm(list=c("totalfilledsteps","totalsteps","activity"))
```
 
## Are there differences in activity patterns between weekdays and weekends?
```{r weekday}
library(plyr)

weekend <- weekdays(as.Date(reorderFilledData$date),TRUE) %in% c("Sat", "Sun")
reorderFilledData$day <- factor(ifelse(weekend, "weekend", "weekday"))

# Average the steps on {interval and day}
dayavg <- ddply(reorderFilledData, .(interval, day), summarize, avgsteps=mean(steps))
```
```{r weeksplot} 
library(lattice)
xyplot(avgsteps ~ interval | day, data = dayavg, layout=c(1,2), type="l", xlab="Interval", ylab="Steps")
```

```{r cleanup, echo=FALSE}
rm(list=ls())
```
